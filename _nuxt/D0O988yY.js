import{f as w,at as U,au as B,c as F,o as A,L as P,av as Q,aw as W,ax as S,S as v,ay as z,ar as I,g as J,az as Y,h as y,aA as M,as as N,aB as E,G as O,w as C,i as G,b as k,j as g,q as R,d as x,m as K,a as T,n as X,p as Z}from"./DlASU2NW.js";import{_ as ee}from"./CUIwPk1Q.js";import{d as te}from"./ZrjKW1__.js";const se=["href"],re={name:"DisclaimerLink"},ne=w({...re,props:{url:{}},setup(r){const e=r,s=U();if(!s)throw B({statusCode:500,statusMessage:"DisclaimerLink must be used inside DisclaimerProvider",fatal:!0});const{shouldShowDisclaimer:t}=s,{showDisclaimer:n}=s;async function a(i){t.value&&(i.preventDefault(),await n(e.url)&&Q(e.url,{external:!0,open:{target:"_blank",windowFeatures:{noopener:!0,noreferrer:!0}}}))}return(i,o)=>(A(),F("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",class:"group",onClick:a},[P(i.$slots,"default")],8,se))}}),Me=Object.assign(ne,{__name:"CoreDisclaimerLink"}),oe=W("/images/datahub.png"),j=S("debouncedInput",()=>{const r=v(""),e=v(""),s=v(null),t=v(!1);function n(i,o=300){r.value=i,s.value&&clearTimeout(s.value),t.value=!0,s.value=setTimeout(()=>{e.value=i,t.value=!1,s.value=null},o)}function a(){r.value="",e.value="",s.value&&(clearTimeout(s.value),s.value=null),t.value=!1}return{input:r,debouncedInput:e,debounceTimer:s,isDebouncing:t,setInput:n,clearInput:a}}),h={CASE_SENSITIVE_EQUAL:7,EQUAL:6,STARTS_WITH:5,CONTAINS:3,ACRONYM:2,MATCHES:1,NO_MATCH:0},V={maxRanking:1/0,minRanking:-1/0};function H(r,e,s){if(s=s||{},s.threshold=s.threshold??h.MATCHES,!s.accessors){const n=$(r,e,s);return{rankedValue:r,rank:n,accessorIndex:-1,accessorThreshold:s.threshold,passed:n>=s.threshold}}const t=le(r,s.accessors);for(let n=0;n<t.length;n++){const a=t[n];let i=$(a.itemValue,e,s);const{minRanking:o,maxRanking:c,threshold:u=s.threshold}=a.attributes;if(i<o&&i>=h.MATCHES?i=o:i>c&&(i=c),i=Math.min(i,c),i>=u&&i>h.NO_MATCH)return{rank:i,passed:!0,accessorIndex:n,accessorThreshold:u,rankedValue:a.itemValue}}return{rankedValue:r,rank:h.NO_MATCH,accessorIndex:-1,accessorThreshold:s.threshold,passed:!1}}function $(r,e,s){if(r=q(r,s),e=q(e,s),e.length>r.length)return h.NO_MATCH;if(r===e)return h.CASE_SENSITIVE_EQUAL;if(r=r.toLowerCase(),e=e.toLowerCase(),r===e)return h.EQUAL;if(r.startsWith(e))return h.STARTS_WITH;if(r.includes(e)){const t=r.indexOf(e);return h.CONTAINS+1/(t+1)}else if(e.length===1)return h.NO_MATCH;return ae(r).includes(e)?h.ACRONYM:ie(r,e)}function ae(r){let e="";return r.split(" ").forEach(t=>{t.split("-").forEach(a=>{e+=a.substr(0,1)})}),e}function ie(r,e){let s=0,t=0;function n(c,u,l){for(let f=l,m=u.length;f<m;f++)if(u[f]===c)return s+=1,f+1;return-1}function a(c){const u=1/c,l=s/e.length;return h.MATCHES+l*u}const i=n(e[0],r,0);if(i<0)return h.NO_MATCH;t=i;for(let c=1,u=e.length;c<u;c++){const l=e[c];if(t=n(l,r,t),!(t>-1))return h.NO_MATCH}const o=t-i;return a(o)}function q(r,{keepDiacritics:e}){return r=`${r}`,r}function ce(r,e){let s=e;typeof e=="object"&&(s=e.accessor);const t=s(r);return t==null?[]:Array.isArray(t)?t:[String(t)]}function le(r,e){const s=[];for(let t=0,n=e.length;t<n;t++){const a=e[t],i=ue(a),o=ce(r,a);for(let c=0,u=o.length;c<u;c++)s.push({itemValue:o[c],attributes:i})}return s}function ue(r){return typeof r=="function"?V:{...V,...r}}function de(r,e,s){return Object.keys(e).map(t=>H(t,s,{threshold:h.ACRONYM})).filter(t=>t.passed).map(t=>({label:t.rankedValue,query:{fieldFilters:[{key:r,value:[t.rankedValue]}]},rank:t.rank,meta:{field:r,matchingText:s,count:e[t.rankedValue]}}))}function fe(r,e){const s=I("~/composables/useSuggestions/rankSuggestions");if(e==="")return s.debug("No search term provided, returning no suggestions."),[];const n=r.data.map(o=>{const c=H(o,e,{threshold:h.ACRONYM,accessors:[f=>f.name]}),u=H(o,e,{threshold:h.CONTAINS,accessors:[{accessor:f=>f.description,maxRanking:3}]}),l=[c,u].toSorted((f,m)=>m.rank-f.rank)[0];return{...l,item:o,field:l===c?"name":l===u?"description":void 0}}).filter(o=>o.passed).map(o=>{const c=o.item?.name??o.rankedValue.name;return{label:c,query:{searchTerm:c,selected:!0,fieldFilters:[]},rank:o.rank,meta:{field:o.field==="name"?"name":o.field==="description"?"description":void 0,matchingText:e,count:0}}}),a=Object.entries(r.fields).flatMap(([o,c])=>de(o,c,e));return[...n,...a].toSorted((o,c)=>c.rank-o.rank)}const pe=z(()=>{const r=I("~/composables/useSuggestions"),{data:e,error:s,status:t}=J(te),n=j(),{debouncedInput:a}=Y(n),i=y(()=>e.value===void 0?(r.debug("No data available, returning no suggestions."),[]):(r.debug("Computing suggestions for input:",a.value),fe(e.value,a.value)));return{status:t,error:s,suggestions:i}});function he(r){const{storeId:e}=r,s=S(`${e}:private`,()=>({fieldFilterState:N({filters:[]})}),{persist:[{storage:M.sessionStorage()}]});return S(e,()=>{const t=I(`stores/${e}`),n=s(),a=y(()=>n.fieldFilterState.filters);function i(){t.debug("Resetting current filters"),n.fieldFilterState={filters:[]}}function o(u){t.debug("Setting filters: ",u),n.fieldFilterState={...u}}const c=y(()=>Object.values(a.value).flatMap(l=>l.value).length>0);return{fieldFilters:a,reset:i,set:o,hasFilters:c}})}const me=he({storeId:"filters"});function ge(r){const{storeId:e,maxHistory:s=5}=r,t=S(`${e}:private`,()=>({history:N([])}),{persist:{storage:M.sessionStorage()}});return S(`${e}`,()=>{const n=I(`stores/${e}`),a=t(),i=y(()=>a.history),o=y(()=>a.history.length>0);function c(l){const f=a.history.findIndex(m=>m.label===l.label);if(f===-1)a.history.length>=s&&(n.debug(`History exceeded max length of ${s}. Removing oldest entry.`),a.history=a.history.slice(0,s-1)),n.debug(`Adding new suggestion to history: "${l.label}"`),a.history=[l,...a.history];else{n.debug(`Suggestion already in history. Moving to top: "${l.label}"`);const m=a.history[f];if(m){const _=[...a.history];a.history=[m,..._.slice(0,f),..._.slice(f+1)]}}}function u(){n.debug("Clearing search history"),a.history=[]}return{getHistory:i,hasHistory:o,addToHistory:c,clearHistory:u}})}const ye=ge({storeId:"history"});function be(r){const{storeId:e}=r,s=S(`${e}:private`,()=>({queryState:N({searchTerm:void 0,selected:void 0})}),{persist:[{storage:M.sessionStorage()}]});return S(e,()=>{const t=I(`stores/${e}`),n=s(),a=y(()=>n.queryState.searchTerm!==void 0),i=y(()=>n.queryState);function o(){t.debug("Clearing current query, including search term and filters"),n.queryState={searchTerm:void 0,selected:void 0}}function c(l){t.debug("Setting search query: ",l),n.queryState={searchTerm:l.searchTerm,selected:l.selected}}function u(l){t.debug("Replacing current query with new query: ",l),n.queryState={searchTerm:l.searchTerm,selected:l.selected}}return{searchQuery:i,hasQuery:a,clear:o,replaceQueryAndFilters:u,setSearch:c}})}const D=be({storeId:"query"}),Se={name:"AutocompleteMenu"},_e=w({...Se,setup(r){const e=E(),s=ye(),t=D(),n=me(),{suggestions:a,status:i}=pe(),o=j();function c(p){p!==void 0&&(t.setSearch(p.query),s.addToHistory(p),n.set({filters:p.query.fieldFilters.map(d=>({key:d.key,value:d.value}))??[]}),e.push({path:"/search"}))}function u(p){if(p!==""){const d={label:p,rank:0,query:{searchTerm:p,fieldFilters:[]}};t.setSearch(d.query),s.addToHistory(d),n.reset(),e.push({path:"/search"})}else t.clear(),e.push({path:"/search"})}function l(p){const d=p.meta?.field;if(d==="description")return`"${p.meta?.matchingText??p.label}" found in description`;if(d==="tags")return`${p.meta?.count??"Discover"} dataset(s) with this tag`}function f(p){const d=p.meta?.field;return d==="name"||d==="description"?"lucide:database":d==="tags"?"lucide:tag":"lucide:search"}const m=y(()=>{if(o.input==="")if(s.getHistory.length>0){const p=s.getHistory.map(d=>({label:d.label,icon:f(d),onSelect:()=>c(d)}));return[{label:"Recent Searches",type:"label"},...p]}else return[];else{const p={label:`Search for "${o.input}"`,leadingIcon:"lucide:search",onSelect:()=>u(o.input)},d=a.value.map(b=>({label:`${b.label}`,description:l(b),icon:f(b),type:"item",onSelect:()=>c(b)}));return[p,...d]}}),_=v("");return(p,d)=>{const b=R,L=ee;return A(),O(L,{"search-term":g(o).input,"model-value":g(_),items:g(m),"ignore-filter":"",icon:"lucide:search","loading-icon":"lucide:loader",loading:g(i)==="pending",placeholder:"Search datasets","open-on-click":"",ui:{root:"w-full mt-4",base:"h-12"},"onUpdate:searchTerm":g(o).setInput},{empty:C(()=>[...d[1]||(d[1]=[x(" Start typing to find suggestions ",-1)])]),trailing:C(()=>[g(o).input!==""?(A(),O(b,{key:0,color:"neutral",variant:"ghost",ui:{base:"bg-default mr-0.5"},size:"xs",icon:"lucide:circle-x","aria-label":"Clear input field",onClick:g(o).clearInput},null,8,["onClick"])):G("",!0),k(b,{to:"/search",onClick:d[0]||(d[0]=Te=>u(g(o).input))},{default:C(()=>[...d[2]||(d[2]=[x(" Search ",-1)])]),_:1})]),_:1},8,["search-term","model-value","items","loading","onUpdate:searchTerm"])}}}),ve=Object.assign(_e,{__name:"AutocompleteMenu"}),Ce={class:"bg-linear-to-r from-blue-50 via-blue-100 to-blue-50"},Ie={class:"flex justify-start w-full"},ke={name:"SearchHero"},Ae=w({...ke,setup(r){const e=K();return(s,t)=>{const n=R,a=Z;return A(),F("section",Ce,[k(a,{class:"h-96 flex flex-col items-center justify-center max-w-200 text-center"},{default:C(()=>[t[1]||(t[1]=T("img",{src:oe,alt:"DataHub Logo",class:"h-[56px] mb-4"},null,-1)),t[2]||(t[2]=T("p",{class:"text-lg"}," The U.S. Department of Transportation Intelligent Transportation Systems (ITS) Joint Program Office's (JPO) portal for open-access data. ",-1)),k(ve),T("div",Ie,[k(n,{to:"/search",variant:"link",size:"sm",class:X({invisible:g(e).fullPath!=="/"})},{default:C(()=>[...t[0]||(t[0]=[x(" View all ",-1)])]),_:1},8,["class"])])]),_:1})])}}}),Ne=Object.assign(Ae,{__name:"SearchHero"});function Oe(){const r=D(),e=E();async function s(t){r.setSearch({searchTerm:t,selected:void 0}),await e.push({path:"/search"})}return{searchByTopic:s}}const Ve={"Connected Vehicle Message":{icon:"/images/topics/cv-message.webp"},"Application Message":{icon:"/images/topics/application-message.webp"},Trajectories:{icon:"/images/topics/trajectories.webp"},"Field Test":{icon:"/images/topics/field-test.webp"},"Sensor Data":{icon:"/images/topics/sensor-data.webp"},"Research Results":{icon:"/images/topics/research-results.webp"},"Connected Equipment":{icon:"/images/topics/connected-equipment.webp"},Weather:{icon:"/images/topics/weather.webp"}};export{Ne as S,Me as _,me as a,h as b,D as c,H as r,Ve as t,Oe as u};
