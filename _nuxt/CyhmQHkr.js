import re from"./DDbT4-To.js";import le from"./IBmhqWhp.js";import{K as j,h as P,j as o,aD as ue,Y as ce,c8 as de,W as te,c9 as fe,aL as Z,a4 as pe,aM as me,a1 as ve,ah as ge,aT as ye,bg as be,a2 as Y,c as z,o as d,b as r,w as u,i as $,F as V,A as w,a as h,n as x,r as ae,bm as G,d as f,t as O,s as q,q as H,x as Q,y as X,a0 as he,aP as ee,k as xe,P as we,f as ie,a8 as ze}from"./CTM-UXwp.js";import{_ as se}from"./DHuvJM40.js";import{u as oe,r as ke,v as _e}from"./C3tgtHDE.js";import{_ as $e,a as Se}from"./C6ukg3sm.js";import{_ as Ce}from"./CNDGWnad.js";import{_ as Fe}from"./1SaarQ5-.js";import{_ as Ue}from"./Cq7QM8z_.js";import{g as qe}from"./CxFUOmY2.js";import{o as Be,h as Te}from"./_e_qfkaz.js";import"./Edj9Qn0N.js";import"./DO-GUAxx.js";import"./DR_irzcd.js";function je(t){if(!t||t==="*")return;const S=t.split(",").map(p=>{const e=p.trim();return e.includes("/")&&e.endsWith("/*")&&e.split("/")[0]||e}).filter(p=>!p.startsWith("."));return S.length>0?S:void 0}function Ae(t){const{accept:S="*",reset:p=!1,multiple:e=!1,dropzone:B=!0,onUpdate:g}=t,a=j(),s=j(),A=P(()=>je(o(S))),F=n=>{!n||n.length===0||(n instanceof FileList&&(n=Array.from(n)),n.length>1&&!e&&(n=[n[0]]),g(n))},U=j(!1),y=ue({open:()=>{}});function l(){y.open()}return ce(()=>{const{isOverDropZone:n}=B?de(s,{dataTypes:A.value,onDrop:F}):{isOverDropZone:j(!1)};te(n,D=>{U.value=D});const{onChange:C,open:m}=fe({accept:o(S),multiple:e,input:o(a),reset:p});y.open=m,C(D=>F(D))}),{isDragging:U,open:l,inputRef:a,dropzoneRef:s}}const De={slots:{root:"relative flex flex-col",base:["w-full flex-1 bg-default border border-default flex flex-col gap-2 items-stretch justify-center rounded-lg focus-visible:outline-2","transition-[background]"],wrapper:"flex flex-col items-center justify-center text-center",icon:"shrink-0",avatar:"shrink-0",label:"font-medium text-default mt-2",description:"text-muted mt-1",actions:"flex flex-wrap gap-1.5 shrink-0 mt-4",files:"",file:"relative",fileLeadingAvatar:"shrink-0",fileWrapper:"flex flex-col min-w-0",fileName:"text-default truncate",fileSize:"text-muted truncate",fileTrailingButton:""},variants:{color:{primary:"",secondary:"",info:"",success:"",warning:"",error:"",dot:"",neutral:""},variant:{area:{wrapper:"px-4 py-3",base:"p-4"},button:{}},size:{xs:{base:"text-xs",icon:"size-4",file:"text-xs px-2 py-1 gap-1",fileWrapper:"flex-row gap-1"},sm:{base:"text-xs",icon:"size-4",file:"text-xs px-2.5 py-1.5 gap-1.5",fileWrapper:"flex-row gap-1"},md:{base:"text-sm",icon:"size-5",file:"text-xs px-2.5 py-1.5 gap-1.5"},lg:{base:"text-sm",icon:"size-5",file:"text-sm px-3 py-2 gap-2",fileSize:"text-xs"},xl:{base:"text-base",icon:"size-6",file:"text-sm px-3 py-2 gap-2"}},layout:{list:{root:"gap-2 items-start",files:"flex flex-col w-full gap-2",file:"min-w-0 flex items-center border border-default rounded-md w-full",fileTrailingButton:"ms-auto"},grid:{fileWrapper:"hidden",fileLeadingAvatar:"size-full rounded-lg",fileTrailingButton:"absolute -top-1.5 -end-1.5 p-0 rounded-full border-2 border-bg"}},position:{inside:"",outside:""},dropzone:{true:"border-dashed data-[dragging=true]:bg-elevated/25"},interactive:{true:""},highlight:{true:""},multiple:{true:""},disabled:{true:"cursor-not-allowed opacity-75"}},compoundVariants:[{color:"primary",class:"focus-visible:outline-primary"},{color:"secondary",class:"focus-visible:outline-secondary"},{color:"info",class:"focus-visible:outline-info"},{color:"success",class:"focus-visible:outline-success"},{color:"warning",class:"focus-visible:outline-warning"},{color:"error",class:"focus-visible:outline-error"},{color:"dot",class:"focus-visible:outline-dot"},{color:"primary",highlight:!0,class:"border-primary"},{color:"secondary",highlight:!0,class:"border-secondary"},{color:"info",highlight:!0,class:"border-info"},{color:"success",highlight:!0,class:"border-success"},{color:"warning",highlight:!0,class:"border-warning"},{color:"error",highlight:!0,class:"border-error"},{color:"dot",highlight:!0,class:"border-dot"},{color:"neutral",class:"focus-visible:outline-inverted"},{color:"neutral",highlight:!0,class:"border-inverted"},{size:"xs",layout:"list",class:{fileTrailingButton:"-me-1"}},{size:"sm",layout:"list",class:{fileTrailingButton:"-me-1.5"}},{size:"md",layout:"list",class:{fileTrailingButton:"-me-1.5"}},{size:"lg",layout:"list",class:{fileTrailingButton:"-me-2"}},{size:"xl",layout:"list",class:{fileTrailingButton:"-me-2"}},{variant:"button",size:"xs",class:{base:"p-1"}},{variant:"button",size:"sm",class:{base:"p-1.5"}},{variant:"button",size:"md",class:{base:"p-1.5"}},{variant:"button",size:"lg",class:{base:"p-2"}},{variant:"button",size:"xl",class:{base:"p-2"}},{layout:"grid",multiple:!0,class:{files:"grid grid-cols-2 md:grid-cols-3 gap-4 w-full",file:"p-0 aspect-square"}},{layout:"grid",multiple:!1,class:{file:"absolute inset-0 p-0"}},{interactive:!0,disabled:!1,class:"hover:bg-elevated/25"}],defaultVariants:{color:"primary",variant:"area",size:"md"}},Me=["id","name","accept","multiple","required","disabled"],Oe=Object.assign({inheritAttrs:!1},{__name:"UFileUpload",props:Z({as:{type:null,required:!1},id:{type:String,required:!1},name:{type:String,required:!1},icon:{type:[String,Object],required:!1},label:{type:String,required:!1},description:{type:String,required:!1},color:{type:null,required:!1},variant:{type:null,required:!1},size:{type:null,required:!1},layout:{type:null,required:!1,default:"grid"},position:{type:null,required:!1,default:"outside"},highlight:{type:Boolean,required:!1},accept:{type:String,required:!1,default:"*"},multiple:{type:Boolean,required:!1,default:!1},reset:{type:Boolean,required:!1,default:!1},dropzone:{type:Boolean,required:!1,default:!0},interactive:{type:Boolean,required:!1,default:!0},required:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},fileIcon:{type:[String,Object],required:!1},fileDelete:{type:[Boolean,Object],required:!1,default:!0},fileDeleteIcon:{type:[String,Object],required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},{modelValue:{type:null},modelModifiers:{}}),emits:Z(["change"],["update:modelValue"]),setup(t,{expose:S,emit:p}){const e=t,B=p,g=pe(),a=me(t,"modelValue"),s=ve(),{t:A}=ge(),[F,U]=ye(),{isDragging:y,open:l,inputRef:n,dropzoneRef:C}=Ae({accept:e.accept,reset:e.reset,multiple:e.multiple,dropzone:e.dropzone,onUpdate:J}),{emitFormInput:m,emitFormChange:D,id:L,name:W,disabled:M,ariaAttrs:E}=be(e),T=P(()=>e.multiple?"area":e.variant),N=P(()=>e.variant==="button"&&!e.multiple?"grid":e.layout),k=P(()=>N.value==="grid"&&e.multiple?"inside":T.value==="button"?"outside":e.position),c=P(()=>Y({extend:Y(De),...s.ui?.fileUpload||{}})({dropzone:e.dropzone,interactive:e.interactive,color:e.color,size:e.size,variant:T.value,layout:N.value,position:k.value,multiple:e.multiple,highlight:e.highlight,disabled:e.disabled}));function I(i){return URL.createObjectURL(i)}function ne(i){if(i===0)return"0B";const b=1024,v=["B","KB","MB","GB"],_=Math.floor(Math.log(i)/Math.log(b)),K=i/Math.pow(b,_);return`${_===0?K.toString():K.toFixed(0)}${v[_]}`}function J(i,b=!1){if(e.multiple)if(b)a.value=i;else{const _=a.value||[];a.value=[..._,...i||[]]}else a.value=i?.[0];const v=new Event("change",{target:{value:a.value}});B("change",v),D(),m()}function R(i){if(!a.value)return;if(!e.multiple||i===void 0){J([],!0),C.value?.focus();return}const b=[...a.value];b.splice(i,1),J(b,!0),C.value?.focus()}return te(a,i=>{(!Array.isArray(i)||!i.length)&&n.value&&(n.value.value="")}),S({inputRef:n,dropzoneRef:C}),(i,b)=>(d(),z(V,null,[r(o(F),null,{default:u(()=>[a.value&&(!Array.isArray(a.value)||a.value.length)?(d(),z(V,{key:0},[w(i.$slots,"files-top",{files:a.value,open:o(l),removeFile:R}),h("div",{class:x(c.value.files({class:e.ui?.files}))},[w(i.$slots,"files",{files:a.value},()=>[(d(!0),z(V,null,ae(Array.isArray(a.value)?a.value:[a.value],(v,_)=>(d(),z("div",{key:v.name,class:x(c.value.file({class:e.ui?.file}))},[w(i.$slots,"file",{file:v,index:_},()=>[w(i.$slots,"file-leading",{file:v,index:_,ui:c.value},()=>[r(G,{as:{img:"img"},src:I(v),icon:t.fileIcon||o(s).ui.icons.file,size:e.size,class:x(c.value.fileLeadingAvatar({class:e.ui?.fileLeadingAvatar}))},null,8,["src","icon","size","class"])]),h("div",{class:x(c.value.fileWrapper({class:e.ui?.fileWrapper}))},[h("span",{class:x(c.value.fileName({class:e.ui?.fileName}))},[w(i.$slots,"file-name",{file:v,index:_},()=>[f(O(v.name),1)])],2),h("span",{class:x(c.value.fileSize({class:e.ui?.fileSize}))},[w(i.$slots,"file-size",{file:v,index:_},()=>[f(O(ne(v.size)),1)])],2)],2),w(i.$slots,"file-trailing",{file:v,index:_,ui:c.value},()=>[t.fileDelete?(d(),q(H,Q({key:0,color:"neutral"},{ref_for:!0},{...N.value==="grid"?{variant:"solid",size:"xs"}:{variant:"link",size:t.size},...typeof t.fileDelete=="object"?t.fileDelete:void 0},{"aria-label":o(A)("fileUpload.removeFile",{filename:v.name}),"trailing-icon":t.fileDeleteIcon||o(s).ui.icons.close,class:c.value.fileTrailingButton({class:e.ui?.fileTrailingButton}),onClick:X(K=>R(_),["stop","prevent"])}),null,16,["aria-label","trailing-icon","class","onClick"])):$("",!0)])])],2))),128))])],2),w(i.$slots,"files-bottom",{files:a.value,open:o(l),removeFile:R})],64)):$("",!0)]),_:3}),r(o(we),{as:t.as,class:x(c.value.root({class:[e.ui?.root,e.class]}))},{default:u(()=>[w(i.$slots,"default",{open:o(l),removeFile:R,ui:c.value},()=>[(d(),q(he(T.value==="button"?"button":"div"),{ref_key:"dropzoneRef",ref:C,type:T.value==="button"?"button":void 0,role:T.value==="button"?void 0:"button","data-dragging":o(y),class:x(c.value.base({class:e.ui?.base})),tabindex:t.interactive&&!o(M)?0:-1,onClick:b[0]||(b[0]=v=>t.interactive&&!o(M)&&o(l)()),onKeydown:b[1]||(b[1]=ee(X(()=>{},["prevent"]),["space"])),onKeyup:b[2]||(b[2]=ee(v=>t.interactive&&!o(M)&&o(l)(),["enter","space"]))},{default:u(()=>[k.value==="inside"?(d(),q(o(U),{key:0})):$("",!0),k.value!=="inside"||(t.multiple?!a.value?.length:!a.value)?(d(),z("div",{key:1,class:x(c.value.wrapper({class:e.ui?.wrapper}))},[w(i.$slots,"leading",{ui:c.value},()=>[T.value==="button"?(d(),q(xe,{key:0,name:t.icon||o(s).ui.icons.upload,class:x(c.value.icon({class:e.ui?.icon}))},null,8,["name","class"])):(d(),q(G,{key:1,icon:t.icon||o(s).ui.icons.upload,size:e.size,class:x(c.value.avatar({class:e.ui?.avatar}))},null,8,["icon","size","class"]))]),T.value!=="button"?(d(),z(V,{key:0},[t.label||g.label?(d(),z("div",{key:0,class:x(c.value.label({class:e.ui?.label}))},[w(i.$slots,"label",{},()=>[f(O(t.label),1)])],2)):$("",!0),t.description||g.description?(d(),z("div",{key:1,class:x(c.value.description({class:e.ui?.description}))},[w(i.$slots,"description",{},()=>[f(O(t.description),1)])],2)):$("",!0),g.actions?(d(),z("div",{key:2,class:x(c.value.actions({class:e.ui?.actions}))},[w(i.$slots,"actions",{files:a.value,open:o(l),removeFile:R})],2)):$("",!0)],64)):$("",!0)],2)):$("",!0)]),_:3},40,["type","role","data-dragging","class","tabindex"])),k.value==="outside"?(d(),q(o(U),{key:0})):$("",!0)]),h("input",Q({id:o(L),ref_key:"inputRef",ref:n,type:"file",name:o(W),accept:t.accept,multiple:t.multiple,required:t.required,disabled:o(M)},{...i.$attrs,...o(E)},{class:"sr-only",tabindex:"-1"}),null,16,Me)]),_:3},8,["as","class"])],64))}}),Ne={class:"flex flex-wrap items-center gap-3"},Re={key:0,class:"text-xs text-muted mt-1.5"},Pe={class:"list-disc list-inside pl-2"},Ve={class:"flex flex-row gap-2"},We={name:"MetadataFileUpload"},Le=ie({...We,emits:["uploadSuccess","uploadCancel"],setup(t,{emit:S}){const p=S,{submitFileUpload:e}=oe(),B=Be({file:Te(File)}),g=j({file:void 0}),a=j([]),s=j(null);async function A(y){const l=[];if(a.value=[],!(y.file instanceof File))return l.push({name:"file",message:"Upload a valid file first"}),l;if(y.file.type!=="application/json")return l.push({name:"file",message:"Ensure your file is JSON"}),l;let n;try{n=await ke(y.file)}catch(m){return console.error("Error reading file:",m),l.push({name:"file",message:"There was an issue reading the file"}),l}let C;try{C=JSON.parse(n)}catch(m){return console.error("Error parsing JSON:",m),l.push({name:"file",message:"There was an issue parsing the JSON file. This file was likely modified since downloading. Please ensure it is valid JSON syntax."}),l}try{const{warnings:m}=await _e(C);a.value=m}catch(m){console.error("Error validating against schema:",m),l.push({name:"file",message:"An unknown error has occurred while validating the file. Please try again with a properly formatted file."})}return l}async function F(y){try{await e(y.data),p("uploadSuccess")}catch(l){console.error("Error parsing submitted file:",l),s.value=qe(l)}}function U(y){y.preventDefault(),g.value.file=void 0,p("uploadCancel")}return(y,l)=>{const n=le,C=G,m=H,D=Oe,L=Se,W=Ce,M=se,E=Fe,T=Ue,N=$e;return d(),q(M,{variant:"soft",ui:{body:"flex flex-col gap-4"}},{default:u(()=>[h("div",null,[r(n,null,{default:u(()=>[...l[2]||(l[2]=[f(" Need to update an existing metadata file and continue working on it? Use the upload field below to upload your ",-1),h("span",{class:"is-italic"},"metadata.json",-1),f(" file and automatically prefill available values. ",-1)])]),_:1}),r(n,null,{default:u(()=>[...l[3]||(l[3]=[h("span",{class:"font-bold"},"WARNING:",-1),f(" If you have already filled out the form on here, this will reset it and replace all existing values with values from the provided file. ",-1)])]),_:1})]),r(N,{schema:o(B),state:g.value,validate:A,onSubmit:F},{default:u(()=>[r(T,null,{default:u(()=>[r(M,{variant:"outline"},{default:u(()=>[r(W,null,{default:u(()=>[r(L,{name:"file",label:"Upload a file",description:"Click the button below to select a file"},{default:u(()=>[r(D,{modelValue:g.value.file,"onUpdate:modelValue":l[0]||(l[0]=k=>g.value.file=k),icon:"lucide:file-json",accept:".json,application/json"},{default:u(({open:k,removeFile:c})=>[h("div",Ne,[r(C,{size:"lg",icon:"lucide:file-json"}),r(m,{label:g.value.file?"Change file":"Select file",color:"neutral",variant:"soft",onClick:I=>k()},null,8,["label","onClick"])]),g.value.file?(d(),z("p",Re,[f(O(g.value.file.name)+" ",1),r(m,{label:"Remove",color:"error",variant:"link",size:"xs",class:"p-0",onClick:I=>c()},null,8,["onClick"])])):$("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a.value&&a.value.length>0?(d(),q(W,{key:0},{default:u(()=>[r(E,{variant:"outline",color:"neutral"},{description:u(()=>[l[4]||(l[4]=h("p",null," There were some issues found while parsing the file. If you continue with the file prefill, these fields will not be populated: ",-1)),h("ul",Pe,[(d(!0),z(V,null,ae(a.value,(k,c)=>(d(),z("li",{key:c},O(k),1))),128))])]),_:1})]),_:1})):$("",!0),h("div",Ve,[r(m,{color:"error",variant:"soft",onClick:l[1]||(l[1]=k=>{U(k)})},{default:u(()=>[...l[5]||(l[5]=[f(" Cancel ",-1)])]),_:1}),r(m,{color:"primary",type:"submit"},{default:u(()=>[...l[6]||(l[6]=[f(" Prefill ",-1)])]),_:1})])]),_:1})]),_:1},8,["schema","state"])]),_:1})}}}),Ee=Object.assign(Le,{__name:"MetadataFileUpload"}),Ie={class:"flex flex-col gap-8"},Je={class:"flex flex-col gap-2"},Ke={class:"flex justify-between"},Ge={name:"MetadataConfirmSubmission"},He=ie({...Ge,setup(t){const{submitConfirmationStatus:S}=oe(),p=j(!1);function e(){p.value=!1}const B=j(!1);function g(){p.value=!1,B.value=!0}return(a,s)=>{const A=re,F=le,U=H,y=se,l=ze;return d(),z("div",Ie,[h("div",null,[r(A,null,{default:u(()=>[...s[2]||(s[2]=[f(" Confirm Submission ",-1)])]),_:1}),r(F,null,{default:u(()=>[...s[3]||(s[3]=[f(" The following form helps you submit your dataset to DataHub by automatically generating the necessary metadata file to be included with your project. ",-1)])]),_:1}),r(F,null,{default:u(()=>[...s[4]||(s[4]=[f(" This form will take several minutes to complete and will require you to provide information about all the files included in your project. Hence, this form should only be used after you have already gained approval via the initial Submission Form. If you have not already received approval, then you will have no way to submit your project and your metadata file will not be accepted. ",-1)])]),_:1}),r(F,null,{default:u(()=>[...s[5]||(s[5]=[f(" Please confirm that you have already submitted initial information about your dataset and have received approval to generate the metadata form and continue with your submission. ",-1)])]),_:1})]),h("div",Je,[h("div",Ke,[r(U,{size:"lg",variant:"soft",color:"neutral",onClick:s[0]||(s[0]=n=>p.value=!0)},{default:u(()=>[...s[6]||(s[6]=[f(" Upload ",-1)])]),_:1}),r(U,{size:"lg",onClick:s[1]||(s[1]=n=>o(S)(!0))},{default:u(()=>[...s[7]||(s[7]=[f(" Confirm ",-1)])]),_:1})]),r(l,{open:p.value},{content:u(()=>[p.value&&!B.value?(d(),q(Ee,{key:0,onUploadCancel:e,onUploadSuccess:g})):B.value?(d(),q(y,{key:1,variant:"soft"},{default:u(()=>[...s[8]||(s[8]=[f(" Available fields have been prefilled. Click confirm to continue. ",-1)])]),_:1})):$("",!0)]),_:1},8,["open"])])])}}}),dl=Object.assign(He,{__name:"MetadataConfirmSubmission"});export{dl as default};
