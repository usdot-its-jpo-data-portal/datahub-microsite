const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CgjD0E0l.js","./DDbT4-To.js","./CTM-UXwp.js","./entry.CIkiVMnX.css","./IBmhqWhp.js","./BwRCwlPJ.js","./C6ukg3sm.js","./DR_irzcd.js","./SEP4cSDA.js","./mmxqorE3.js","./BKowkTF0.js","./CM4A4mA2.js","./05kT4I3W.js","./DZ9OMGKV.js","./DIJoEdYV.js","./DGaKuYAa.js","./Cq7QM8z_.js","./DHuvJM40.js","./_e_qfkaz.js","./Edj9Qn0N.js","./DO-GUAxx.js","./CyhmQHkr.js","./CNDGWnad.js","./1SaarQ5-.js","./CxFUOmY2.js","./Cf74hYj8.js","./DMXReEX-.js","./CW54TMvo.js","./Zh0PsCTm.js","./C3kjAFi6.js","./CefzYZ3M.js","./DhYtaoLf.js","./DaASx7Q-.js","./CUbIosgL.js"])))=>i.map(i=>d[i]);
import{_ as de}from"./DHuvJM40.js";import{f as V,c as R,o as f,a as I,s as _,k as me,F as X,d as pe,t as U,aw as fe,az as ve,K as y,h as O,ay as ge,r as he,j as v,b as P,A as ye,aF as _e,aG as D,aH as N,l as be,m as Se,Z as xe,w as A,p as Ce,i as Ie}from"./CTM-UXwp.js";import{o as p,a as d,e as B,s as r,_ as j,b as x}from"./_e_qfkaz.js";import{s as we}from"./Edj9Qn0N.js";import{C as Fe}from"./DO-GUAxx.js";const De=["aria-current","data-active","data-selectable"],Ne=["disabled"],Ee={"data-slot":"indicator",class:"flex items-center justify-center rounded-full text-white size-10 font-bold border-2 border-white group-data-[active=true]:bg-white group-data-[active=true]:text-primary group-data-[active=true]:border-primary"},Te={"data-slot":"header",class:"flex flex-col text-start"},je={"data-slot":"subtitle",class:"text-white/80 text-xs text-wrap"},ke={"data-slot":"title",class:"text-white font-semibold text-sm uppercase"},$e={name:"MetadataStepperItem"},Ue=V({...$e,props:{item:{}},emits:["select"],setup(e,{emit:a}){const o=e,s=a;return(l,t)=>{const g=me;return f(),R("div",{"aria-current":o.item.isSelected?"true":void 0,"data-slot":"item","data-active":o.item.isSelected,"data-selectable":o.item.isSelectable,class:"group"},[I("button",{"data-slot":"trigger",disabled:!o.item.isSelectable,class:"flex w-full items-center gap-4 rounded-lg p-2 border-2 border-transparent cursor-not-allowed opacity-60 group-data-[active=true]:border-primary/50 group-data-[selectable=true]:cursor-pointer group-data-[selectable=true]:opacity-100 group-data-[selectable=true]:hover:bg-primary/50",onClick:t[0]||(t[0]=u=>s("select",u,o.item.value))},[I("div",Ee,[o.item.isCompleted?(f(),_(g,{key:0,name:"lucide:check","data-slot":"icon",class:"shrink-0"})):(f(),R(X,{key:1},[pe(U(o.item.number),1)],64))]),I("div",Te,[I("p",je," Step "+U(o.item.number),1),I("h4",ke,U(o.item.title),1)])],8,Ne)],8,De)}}}),Ae=Object.assign(Ue,{__name:"MetadataStepperItem"}),m=[];for(let e=0;e<256;++e)m.push((e+256).toString(16).slice(1));function Pe(e,a=0){return(m[e[a+0]]+m[e[a+1]]+m[e[a+2]]+m[e[a+3]]+"-"+m[e[a+4]]+m[e[a+5]]+"-"+m[e[a+6]]+m[e[a+7]]+"-"+m[e[a+8]]+m[e[a+9]]+"-"+m[e[a+10]]+m[e[a+11]]+m[e[a+12]]+m[e[a+13]]+m[e[a+14]]+m[e[a+15]]).toLowerCase()}let z;const Re=new Uint8Array(16);function Le(){if(!z){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");z=crypto.getRandomValues.bind(crypto)}return z(Re)}const Me=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),K={randomUUID:Me};function Oe(e,a,o){e=e||{};const s=e.random??e.rng?.()??Le();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,Pe(s)}function q(e,a,o){return K.randomUUID&&!e?K.randomUUID():Oe(e)}async function ze(e){return new Promise((a,o)=>{const s=new FileReader;s.onload=l=>{const t=l.target?.result;typeof t=="string"?a(t):o(new TypeError("Could not read file as a string"))},s.onerror=l=>{const t=l.target?.error;if(t instanceof DOMException)switch(t.name){case"NotFoundError":console.error("File not found or was removed");break;case"NotReadableError":console.error("File cannot be read - check permissions");break;case"SecurityError":console.error("File reading was cancelled");break;default:console.error("Unknown error:",t.message)}o(new Error("An error occurred while reading the file"))},s.readAsText(e)})}const G=["Automobiles","Trucking and Motorcoaches","Transit","Roadway and Bridges","Railroads","Public Transit","Bicycles and Pedestrians"],H={Number:"Number",Text:"Text",calendar_date:"calendar_date (Date/Time)",Point:"Point (GPS Coordinate)",Checkbox:"Checkbox (Boolean)",URL:"URL"},L=r().min(1,"Filename cannot be empty").max(255,"Filename is too long").regex(/^[\w.\-() ]+$/,"Filename contains invalid characters").refine(e=>!e.endsWith(".")&&!e.endsWith(" "),"Filename cannot end with a dot or space").refine(e=>!/^(?:CON|PRN|AUX|NUL|COM[1-9]|LPT[1-9])(?:\.|$)/i.test(e),"Filename uses a reserved name"),qe=p({publisher:r().nonempty("Publisher is required"),contactName:r().nonempty("Contact Name is required"),contactEmail:B("Contact Email must be a valid email address")}),Ve=p({geographicCoverage:r().nonempty("Geographic coverage information is required"),category:j(G),tags:d(r()).min(5,"At least 5 tags are required").max(15,"No more than 15 tags are allowed")}),J=p({id:x(),title:r().nonempty("Dataset title is required"),fileName:L,description:r().min(10,"Description should be at least 10 characters")}),gt=d(J).min(1,"At least one dataset is required").refine(e=>{const a=e.map(o=>o.title);return a.length===new Set(a).size},{error:"Datasets should have unique titles."}).refine(e=>{const a=e.map(o=>o.fileName);return a.length===new Set(a).size},{error:"Datasets should be in separate files with unique names."}),Z=p({id:x(),name:r().nonempty("Column name is required"),description:r().min(10,"Column description should be at least 10 characters"),dataType:j(Object.keys(H))}),Be=d(Z).min(1,"At least one column is required per dataset").refine(e=>{const a=e.map(o=>o.name);return a.length===new Set(a).size},{error:"Column names should be unique"}),Ge=p({datasetId:x(),columns:Be}),ht=d(Ge),Q=p({id:x(),name:L,datasetIds:d(x()).min(1,"At least one associated dataset is required")}),yt=d(Q).refine(e=>{const a=e.map(o=>o.name);return a.length===new Set(a).size},{error:"File names must be unique"});p({projectInformation:qe.partial(),additionalDetails:Ve.partial(),datasets:d(J.partial().extend({id:x()})),datasetColumns:d(p({datasetId:x(),columns:d(Z.partial().extend({id:x()}))})),supplementaryFiles:d(Q.partial().extend({id:x()}))});p({projectInformation:p({publisher:r(),contactName:r(),contactEmail:B(),category:j(G),geographicCoverage:r(),tags:d(r())}).partial(),datasets:d(p({title:r().optional(),fileName:L.optional(),description:r().optional(),columns:d(p({name:r().optional(),description:r().optional(),dataType:j(H).optional()})),supplementaryFiles:d(r()).optional()})).optional()});async function He(e){const a=[];function o(t,g){t.issues.forEach(u=>{const C=r().catch("something else").parse(u.expected),h=we().catch("an invalid value").parse(t.value);a.push(`${g} (expected ${C} but received: ${h})`)})}return{data:await p({projectInformation:p({publisher:r().optional().catch(t=>o(t,"Publisher")),contactName:r().optional().catch(t=>o(t,"Contact Name")),contactEmail:B().optional().catch(t=>o(t,"Contact Email")),category:j(G).optional().catch(t=>o(t,"Category")),geographicCoverage:r().optional().catch(t=>o(t,"Geographic Coverage")),tags:d(r()).optional().catch(t=>o(t,"Tags"))}),datasets:d(p({title:r().optional().catch(t=>o(t,"Dataset Title")),fileName:L.optional(),description:r().optional().catch(t=>o(t,"Dataset Description")),columns:d(p({name:r().optional().catch(t=>o(t,"Column Name")),description:r().optional().catch(t=>o(t,"Column Description")),dataType:j(H).optional().catch(t=>o(t,"Column Data Type"))})),supplementaryFiles:d(r()).optional().catch(t=>o(t,"Supplementary Files"))}))}).parseAsync(e),warnings:a}}function Ke(e){const a=[],o=[],s=[];for(const l of e.datasets??[]){const t=q();o.push({id:t,title:l.title??"",fileName:l.fileName??"",description:l.description??""});const g=(l.columns??[]).map(u=>({id:q(),name:u.name,description:u.description,dataType:u.dataType})).filter(u=>u.name!==void 0&&u.description!==void 0&&u.dataType!==void 0);s.push({datasetId:t,columns:g});for(const u of l.supplementaryFiles??[]){const C=a.findIndex(E=>E.name===u),h=a[C];h===void 0?a.push({id:q(),name:u,datasetIds:[t]}):h.datasetIds?.includes(t)||a[C]?.datasetIds?.push(t)}}return{projectInformation:{publisher:e.projectInformation.publisher,contactName:e.projectInformation.contactName,contactEmail:e.projectInformation.contactEmail},additionalDetails:{geographicCoverage:e.projectInformation.geographicCoverage,category:e.projectInformation.category,tags:e.projectInformation.tags},datasets:o,datasetColumns:s,supplementaryFiles:a}}async function We(e){try{const a=await ze(e),o=JSON.parse(a),{data:s}=await He(o);return s}catch(a){throw console.error("Error parsing file submission:",a),a}}const S=[{number:1,value:"confirmSubmission",title:"Confirm Submission",progress:10},{number:2,value:"projectInformation",title:"Project Information",progress:20},{number:3,value:"additionalDetails",title:"Additional Details",progress:30},{value:"datasets",title:"Datasets",number:4,progress:50},{number:5,value:"datasetColumns",title:"Dataset Columns",progress:85},{number:6,value:"supplementaryFiles",title:"Supplementary Files",progress:95},{number:7,value:"summary",title:"Summary",progress:100}],W=fe("metadataForm",()=>{const e=y("confirmSubmission"),a=y("confirmSubmission"),o=y([]);function s(n){if(o.value.includes(n)){console.warn(`Step is already marked as completed: ${n}. Skipping...`);return}o.value.push(n)}function l(n){a.value=n}function t(){const n=S.findIndex(c=>c.value===e.value);if(n===-1){console.warn(`Current step value not found: ${e.value}. Cannot move to next step.`);return}if(n===S.length-1){console.warn(`Current step is the last step: ${e.value}. Cannot move to next step.`);return}const i=S[n+1];if(!i){console.warn(`Next step not found after current step: ${e.value}. Cannot move to next step.`);return}e.value=i.value}function g(){const n=S.findIndex(c=>c.value===e.value);if(n===-1){console.warn(`Current step value not found: ${e.value}. Cannot move to next step.`);return}if(n===0){console.warn(`Current step is the first step: ${e.value}. Cannot move to previous step.`);return}const i=S[n-1];if(!i){console.warn(`Next step not found after current step: ${e.value}. Cannot move to next step.`);return}e.value=i.value}const u=O(()=>{const n=S.find(i=>i.value===e.value);return n||(console.warn(`Selected step value not found: ${e.value}. Returning first step.`),S[0])}),C=O(()=>S.map(n=>({...n,isCompleted:o.value.includes(n.value),isSelected:n.value===e.value,isSelectable:o.value.includes(n.value)||n.value===a.value}))),h=y(!1),E=y({}),T=y({}),w=y([]),b=y([]),k=y([]),Y=O(()=>{const n=new Set([...T.value.tags??[],"intelligent transportation systems (its)","its joint program office (jpo)"]),i={...E.value,category:T.value.category,geographicCoverage:T.value.geographicCoverage,tags:Array.from(n)},c=Array.from(k.value),M=w.value.map($=>({title:$.title,fileName:$.fileName,description:$.description,columns:b.value.find(F=>F.datasetId===$.id)?.columns.map(F=>{const{id:ut,...ue}=F;return ue})??[],supplementaryFiles:c.filter(F=>F.datasetIds?.includes($.id)).map(F=>F.name)}));return{projectInformation:i,datasets:M}}),ee=y(null);async function te(n){try{const i=await We(n.file),c=Ke(i);E.value=c.projectInformation,T.value=c.additionalDetails,w.value=c.datasets,b.value=c.datasetColumns,k.value=c.supplementaryFiles}catch(i){console.error("Error parsing submitted file:",i)}}function ae(n){h.value=n,s("confirmSubmission"),l("projectInformation"),t()}function oe(n){E.value={...n},s("projectInformation"),l("additionalDetails"),t()}function ne(n){T.value={...n},s("additionalDetails"),l("datasets"),t()}function se(n){w.value=n;for(const i of w.value)b.value.find(c=>c.datasetId===i.id)||b.value.push({datasetId:i.id,columns:[]});for(const i of b.value)w.value.find(c=>c.id===i.datasetId)||(b.value=b.value.filter(c=>c.datasetId!==i.datasetId));for(const i of k.value)i.datasetIds=i.datasetIds?.filter(c=>w.value.find(M=>M.id===c));s("datasets"),l("datasetColumns"),t()}function re(n){b.value=n,s("datasetColumns"),l("supplementaryFiles"),t()}function ie(n){k.value=n,s("supplementaryFiles"),l("summary"),t()}function le(){s("summary")}function ce(n){if(!S.find(i=>i.value===n)){console.warn(`Step value passed to setSelectedStep does not exist: ${n}. Skipping...`);return}if(!(o.value.includes(n)||n===a.value)){console.warn(`Step value passed to setSelectedStep is not selectable: ${n}. Skipping...`);return}e.value=n}return{selectedStep:e,currentStep:a,completedStepValues:o,getFormSteps:C,getSelectedStep:u,setSelectedStep:ce,moveToPreviousStep:g,confirmationStatus:h,submitConfirmationStatus:ae,submitFileUpload:te,projectInformation:E,submitProjectInformation:oe,additionalDetails:T,submitAdditionalDetails:ne,datasets:w,submitDatasets:se,datasetColumns:b,submitDatasetColumns:re,supplementaryFiles:k,submitSupplementaryFiles:ie,getSummary:Y,submitSummaryStatus:le,error:ee}},{persist:{storage:ve.sessionStorage()}}),Xe={role:"group","data-slot":"root","aria-label":"progress",class:"flex gap-4 flex-col md:flex-row"},Je={"data-slot":"navigation",class:"p-4 flex flex-col gap-2 bg-dot rounded-lg w-full md:w-sm"},Ze={"data-slot":"content",class:"w-full flex flex-col gap-4 p-2"},Qe={"aria-live":"polite","aria-atomic":"true",role:"status",style:{transform:"translateX(-100%)",position:"absolute",pointerEvents:"none",opacity:0,margin:0}},Ye={name:"MetadataStepper"},et=V({...Ye,setup(e){const{getFormSteps:a,getSelectedStep:o}=ge(W()),{setSelectedStep:s}=W();function l(t,g){if(t.ctrlKey===!1){s(g);return}t.preventDefault()}return(t,g)=>{const u=Ae,C=_e;return f(),R("div",Xe,[I("div",Je,[(f(!0),R(X,null,he(v(a),h=>(f(),_(u,{key:h.value,item:h,onSelect:l},null,8,["item"]))),128))]),I("div",Ze,[P(C,{modelValue:v(o).progress,"onUpdate:modelValue":g[0]||(g[0]=h=>v(o).progress=h)},null,8,["modelValue"]),ye(t.$slots,"default",{item:v(o)})]),I("div",Qe," Step "+U(v(o)?.number??1)+" of "+U(v(a).length),1)])}}}),tt=Object.assign(et,{__name:"MetadataStepper"}),at=D(()=>N(()=>import("./CgjD0E0l.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),import.meta.url).then(e=>e.default||e.default||e)),ot=D(()=>N(()=>import("./CyhmQHkr.js"),__vite__mapDeps([21,1,2,3,4,17,6,7,22,16,23,24,18,19,20]),import.meta.url).then(e=>e.default||e.default||e)),nt=D(()=>N(()=>import("./Cf74hYj8.js"),__vite__mapDeps([25,1,2,3,4,26,5,6,7,9,10,11,27,8,16,22,17,28,18,19,20]),import.meta.url).then(e=>e.default||e.default||e)),st=D(()=>N(()=>import("./C3kjAFi6.js"),__vite__mapDeps([29,1,2,3,4,30,5,6,7,27,22,16,8,17,23,28,18,19,20]),import.meta.url).then(e=>e.default||e.default||e)),rt=D(()=>N(()=>import("./DhYtaoLf.js"),__vite__mapDeps([31,1,2,3,4,5,6,7,8,16,22,17,18,19,20]),import.meta.url).then(e=>e.default||e.default||e)),it=D(()=>N(()=>import("./DaASx7Q-.js"),__vite__mapDeps([32,1,2,3,4,17,18,19,20]),import.meta.url).then(e=>e.default||e.default||e)),lt=D(()=>N(()=>import("./CUbIosgL.js"),__vite__mapDeps([33,1,2,3,4,23,5,6,7,12,13,10,11,14,15,22,16,8,17,28,18,19,20]),import.meta.url).then(e=>e.default||e.default||e)),ct=V({__name:"metadata-form",setup(e){return be({title:"Metadata Form",ogUrl:`https://its.dot.gov/data${Se().fullPath}`}),xe(()=>{sessionStorage?.removeItem("metadataForm")}),(a,o)=>{const s=de,l=Ce;return f(),_(l,{class:"py-12 max-w-280"},{default:A(()=>[P(s,null,{default:A(()=>[P(v(Fe),null,{default:A(()=>[P(tt,null,{default:A(({item:t})=>[t.value==="confirmSubmission"?(f(),_(v(ot),{key:0})):t.value==="projectInformation"?(f(),_(v(rt),{key:1})):t.value==="additionalDetails"?(f(),_(v(at),{key:2})):t.value==="datasets"?(f(),_(v(st),{key:3})):t.value==="datasetColumns"?(f(),_(v(nt),{key:4})):t.value==="supplementaryFiles"?(f(),_(v(lt),{key:5})):t.value==="summary"?(f(),_(v(it),{key:6})):Ie("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}}}),_t=Object.freeze(Object.defineProperty({__proto__:null,default:ct},Symbol.toStringTag,{value:"Module"}));export{Ve as a,H as b,Z as c,ht as d,q as e,J as f,gt as g,yt as h,_t as m,qe as p,ze as r,Q as s,W as u,He as v};
